# InformationSecurityAndInformationProtection
## HomeWork

### Навигатор по этапам
На данной странице вы можете пройтись по этапам.

Информация, полученная при выполнении данных этапов, будет помогать вам понимать возможные уязвимости и не совершать ошибки. Наверное.

> Делая всё то же самое во благо своего кармана или во вред кому-то можно пойти по другим этапам! Допустимо применение только при законном тестировании сайтов на уязвимости (своих или работодателя/нанимателя). Для этого уже должна быть договорённость о подобных действиях, что вам их разрешают выполнять.

Выполните задания/действия, ответьте на вопросы и напишите отчёт о том, как вы это делали. Отчёт с картинками! В отчёте главное — это красивые картинки, которые будут у всех различаться. У задания главное — чтобы у вас в голове что-нибудь осталось.

### Немного о HTTP
**HTTP** — это протокол передачи гипертекста (текста с разметками), который сейчас передаёт много всего другого, которое не всегда гипер, и не всегда текст.

Протокол основывался на парадигме "1 запрос — 1 ответ". Раньше был 1 запрос в рамках одного соединения, начиная с версии протокола HTTP/2.0 — много запросов в рамках соединения, но все они выполняются по одним и тем же правилам: запрос-ответ.

#### Как выглядит запрос HTTP?
Пример:

GET /some-location HTTP/1.1 Host: graphworld.ru Header1: Some header 1 value Header2: Some header 2 value

Это тело запроса, его может не быть.

#### А ответ может выглядеть так:

HTTP/1.1 200 OK Header1: Some header 1 value Header2: Some header 2 value

Это тело ответа, оно как правило есть, но может и отсутствовать, если в заголовках достаточно информации.


Обо всём этом можно узнать подробнее, открыв инспектор через F12 в браузере и посмотрев на вкладке **Сеть** заголовки запросов и ответов, их тело и прочее, а также почитав немного информации об этом.

#### Формат запроса:
1. В первой строке указывается метод, ресурс и протокол, например: `POST /hello HTTP/1.1`
2. Далее каждая непустая строка содержит запись в виде `Заголовок: Значение`, которые позволяют уточнить запрос.
3. После первой пустой строки идёт тело запроса.

Перенос строки специфичный и выглядит как: `"\r\n"` на языке C.

#### Формат ответа:
1. В первой строке указывается протокол, код ответа, необязательное сообщение, например: `HTTP/1.1 200 OK`
2. Далее каждая непустая строка содержит запись в виде `Заголовок: Значение`, которые позволяют уточнить запрос.
3. После первой пустой строки идёт тело ответа.

Перенос строки специфичный и выглядит как: `"\r\n"` на языке C.

Чем-то они похожи, верно?

В спецификации описано много методов, например `GET`, `POST`, `PUT`, `DELETE`, `HEAD`, `OPTIONS`, `PATCH`.

Также описаны коды ответов, которые разбиваются на категории:

- **Коды 1XX** — смена протокола, например, на WebSocket.
- **Коды 2XX** — успешный ответ. `200 OK`, `201 Created`.
- **Коды 3XX** — перенаправление. `302 Found`, `301 Moved Permanently`. Обычно используются с заголовком `Location`.
- **Коды 4XX** — ошибка пользователя. `404 Not Found`, `403 Forbidden`, `401 Unauthorized`.
- **Коды 5XX** — ошибка на стороне сервера. `500 Internal Server Error`.

Браузер — не единственная программа, которая может работать через HTTP.

#### Парадигма REST
REST — это обмен сообщениями через HTTP. Нет состояния у соединения, вся необходимая информация передаётся вместе с запросом. У нас есть какие-то ресурсы, у них есть URL. И к ним применяются методы `GET`, `PUT`, `POST`, `DELETE` и прочие.

Часто используется в микросервисах — маленьких серверных программах, выполняющих какие-либо отдельные действия.

Данный протокол — один из столпов сети. Остальное можно почитать в соответствующих документах RFC или узнать самостоятельно.

### Теперь перейдём к заданиям

#### Атака SQL-Injection (Внедрение SQL-кода)
**Авторизация и внедрение SQL (SQL Injection)**.

Вам нужно войти за пользователя `admin`, но за него войти нельзя, так как пароль не задан.

Не беда! Код сервера был написан из рук вон плохо (что хорошо).

Используйте атаку SQL-инъекция из класса внедрения кода для того, чтобы это сделать.

**Вопросы для отчёта:**
1. Поможет ли экранирование пришедших извне параметров, и что это вообще такое экранирование?
2. Помогут ли "вставки" параметров? То есть запросы вида: `SELECT * FROM table WHERE column1=? AND column2=?` с последующей подстановкой значений в заранее заданные места с помощью специальной функции?
3. Помогут ли для этого специальные библиотеки ORM (Object-Relation Mapping) и прочие, которые сами составляют запросы для получения и сохранения объектов из/в базу данных?

#### Атака XSS (Межсайтовый скриптинг)
**Комментарии и кража данных через межсайтовый скриптинг (XSS) и просмотр украденных паролей**.

HTML-страницы допускают различные вставки. Если ввод не обрабатывается и после отправляется пользователю, то можно получить очень нехорошие последствия, так как через JavaScript можно многое поменять.

Вообще, не стоит доверять хранить логику в неподконтрольных местах, так как тем самым создаётся потенциальная проблема.

**Задание:**
1. Напишите комментарий такого содержания: `<script> alert('Данный сайт подвержен XSS атаке'); </script>`. Что-то случилось?
2. Попробуйте написать нужный комментарий, который изменяет место, куда посылаются данные из формы входа со страницы `/xss/comments` на страницу `/xss/passwords/`. Для этого нужно в комментарий вставить JavaScript-код в `<script></script>`, где найти первую форму (тег `form`, можно использовать `document.forms[0]` в коде JavaScript) и заменить атрибут `action` на `/xss/passwords/`.

**Цель задания:**
Понять, как это работает, почему это опасно и как с этим бороться!

**Вопросы для отчёта:**
- Как можно с этим бороться?
- Например, как можно убрать весь JS-код из строки? Можно ли это сделать экранированием?

#### Атака CSRF
**Банк и отправка запроса от имени авторизованного пользователя со стороннего сайта**

**Логин:** `user`, **пароль:** `password`.

Для авторизации на сайте часто используют Cookie. В них записывается какое-то значение, которое будет храниться в браузере. Данной Cookie устанавливают флаг `HttpOnly`, чтобы нельзя было Cookie украсть. Не беда! Печеньки пересылаются каждый раз, когда пользователь заходит на сайт автоматически. Если мы отправим форму на данный сайт, то cookie будут отправлены вместе с запросом. Сайт же совпадает.

**Цель задания:**
Создать возможность с одного сайта отправить запрос на другой сайт, который выполнит необходимые действия.

В данном примере немногоуважаемый господин просит поставить лайк котику и поделиться попугаями со счёта в банке. Когда нажимаем на кнопку, происходит запрос на другую страницу. Если вы там авторизованы, то попугаи переведутся.

Попугаи* — это очень перспективная монета. Обеспечена не более, чем доверием людей к ней, как криптовалюты и прочие деньги. Имеет право на существование.

**Задание:**
Используя любой инструмент, отличный от браузера, пошлите запрос серверу. Можно использовать программу `curl`. Запрос POST, укажите отрицательный параметр `ammount`. Не забудьте про ваши печеньки (cookies), их нужно указать в запросе в заголовке `Set-Cookie`.

**Вопросы для отчёта:**
- Как защититься от такой атаки? Подумайте или поищите, что такое CSRF-токен.

#### Соревнование процессов и асинхронность
Идём сюда и гоняем!

Вы — пользователь `Nagibator3000` с очень тайным паролем — `Nagibator3000`.

**Суть проблемы:**
Мы делаем несколько запросов подряд. В первом — проверка. Во втором — запрет на повторение действий. В третьем — изменение данных.

Между проверкой и запретом существует временной интервал, когда проверка ещё будет проходить, поэтому возможно начать несколько действий. Ну, и они могут даже выполниться. Например, в данном задании вы можете много раз вернуть один предмет на странице игрового магазина. В итоге мы получаем проблему чтения грязных данных.

**Описание проблемы:**
При нажатии на кнопку "Вернуть" происходит POST-запрос на сервер. На сервере происходит проверка, вернули заказ или нет через SELECT — это запрос №1. Далее происходит изменение данных и делается отметка, что заказ возвращён. Для примера специально между данными действиями была добавлена задержка. В итоге вы можете много раз нажать на кнопку, и запрос выполнится несколько раз. То есть вы несколько раз вернёте средства за покупку... Непорядок? А то!
